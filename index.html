<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherWise - Heavenly Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>
<body>

    <div class="background-container">
        <div class="stars"></div>
        <div class="nebula nebula1"></div>
        <div class="nebula nebula2"></div>
        <div class="nebula nebula3"></div>
        <div class="nebula nebula4"></div>
    </div>

    <div id="loader" class="loader-container">
        <div class="loader"></div>
    </div>

    <main class="app-container">
        <header class="app-header reveal-on-scroll">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search for a city...">
                <button id="searchButton" aria-label="Search"><img src="./search.png" alt="Search" width="24"></button>
            </div>
        </header>

        <div class="content-grid">
            <section class="card current-weather reveal-on-scroll" data-tilt data-tilt-max="5" data-tilt-speed="400" data-tilt-perspective="1000">
                <div>
                    <h2 id="cityName">Guwahati</h2>
                    <p id="weatherDesc">Clear Sky</p>
                    <p class="temperature"><span id="currentTemp">--</span>°C</p>
                    <p id="currentDate">August 3, 2025</p>
                </div>
                <skycon-icon icon="CLEAR_DAY" size="128" color="white"></skycon-icon>
            </section>

            <section class="card hourly-forecast reveal-on-scroll" data-tilt data-tilt-max="5" data-tilt-speed="400" data-tilt-perspective="1000">
                <h3>Today's Forecast</h3>
                <div class="hourly-container" id="hourlyContainer"></div>
            </section>
            
            <div class="sub-grid">
                <section class="card air-quality reveal-on-scroll" data-tilt data-tilt-max="5" data-tilt-speed="400" data-tilt-perspective="1000">
                    <h3>Air Quality</h3>
                    <div class="aqi-grid">
                        <div class="aqi-item">
                            <div class="aqi-label"><span>CO</span><strong id="coValue">-</strong></div>
                            <div class="gauge"><div class="gauge-bar" id="coGauge"></div></div>
                        </div>
                        <div class="aqi-item">
                            <div class="aqi-label"><span>NO₂</span><strong id="no2Value">-</strong></div>
                            <div class="gauge"><div class="gauge-bar" id="no2Gauge"></div></div>
                        </div>
                        <div class="aqi-item">
                            <div class="aqi-label"><span>O₃</span><strong id="o3Value">-</strong></div>
                            <div class="gauge"><div class="gauge-bar" id="o3Gauge"></div></div>
                        </div>
                        <div class="aqi-item">
                            <div class="aqi-label"><span>SO₂</span><strong id="so2Value">-</strong></div>
                            <div class="gauge"><div class="gauge-bar" id="so2Gauge"></div></div>
                        </div>
                    </div>
                </section>

                <section class="card sunrise-sunset reveal-on-scroll" data-tilt data-tilt-max="5" data-tilt-speed="400" data-tilt-perspective="1000">
                    <h3>Sunrise & Sunset</h3>
                    <div class="sun-grid">
                        <div class="sun-item"><img src="./sun (1).png" alt="Sunrise" width="50"><div><p>Sunrise</p><strong id="sunriseTime">--:--</strong></div></div>
                        <div class="sun-item"><img src="./moon.png" alt="Sunset" width="40"><div><p>Sunset</p><strong id="sunsetTime">--:--</strong></div></div>
                    </div>
                </section>
            </div>

            <section class="card highlights reveal-on-scroll" data-tilt data-tilt-max="5" data-tilt-speed="400" data-tilt-perspective="1000">
                <h3>Today's Highlights</h3>
                <div class="highlights-grid">
                    <div class="highlight-card"><p>Humidity</p><strong id="humidityValue">--%</strong></div>
                    <div class="highlight-card"><p>Pressure</p><strong id="pressureValue">-- hPa</strong></div>
                    <div class="highlight-card"><p>Visibility</p><strong id="visibilityValue">-- km</strong></div>
                    <div class="highlight-card"><p>Feels Like</p><strong id="feelsLikeValue">--°</strong></div>
                </div>
            </section>

            <section class="card five-day-forecast reveal-on-scroll" data-tilt data-tilt-max="5" data-tilt-speed="400" data-tilt-perspective="1000">
                <h3>5-Day Forecast</h3>
                <div class="daily-container" id="dailyContainer"></div>
            </section>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skycons-html5-element@1.0.2/skycons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.1/vanilla-tilt.min.js"></script>
    
    <script>
        const API_KEY = 'd28274b5fe592e1f1e558103a5e66370';

        function animateCountUp(el, to) {
            let from = 0;
            const duration = 1500;
            const frameDuration = 1000 / 60;
            const totalFrames = Math.round(duration / frameDuration);
            let frame = 0;
            const counter = setInterval(() => {
                frame++;
                const progress = frame / totalFrames;
                const current = from + (to - from) * progress;
                el.text(Math.round(current));
                if (frame === totalFrames) clearInterval(counter);
            }, frameDuration);
        }

        function getSkycon(icon) {
            const map = {
                '01d': 'CLEAR_DAY', '01n': 'CLEAR_NIGHT', '02d': 'PARTLY_CLOUDY_DAY', '02n': 'PARTLY_CLOUDY_NIGHT',
                '03d': 'CLOUDY', '03n': 'CLOUDY', '04d': 'CLOUDY', '04n': 'CLOUDY',
                '09d': 'RAIN', '09n': 'RAIN', '10d': 'RAIN', '10n': 'RAIN',
                '11d': 'SLEET', '11n': 'SLEET', '13d': 'SNOW', '13n': 'SNOW', '50d': 'FOG', '50n': 'FOG'
            };
            return map[icon] || 'CLEAR_DAY';
        }
        
        function updateWeatherUI(data) {
            $('#cityName').text(data.name);
            $('#weatherDesc').text(data.weather[0].description);
            animateCountUp($('#currentTemp'), data.main.temp);
            $('#currentDate').text(new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }));
            document.querySelector('skycon-icon').setAttribute('icon', getSkycon(data.weather[0].icon));
            $('#humidityValue').text(`${data.main.humidity}%`);
            $('#pressureValue').text(`${data.main.pressure} hPa`);
            $('#visibilityValue').text(`${(data.visibility / 1000).toFixed(1)} km`);
            $('#feelsLikeValue').text(`${Math.round(data.main.feels_like)}°`);
            const timeFormat = { hour: '2-digit', minute: '2-digit', hour12: true };
            $('#sunriseTime').text(new Date(data.sys.sunrise * 1000).toLocaleTimeString('en-US', timeFormat));
            $('#sunsetTime').text(new Date(data.sys.sunset * 1000).toLocaleTimeString('en-US', timeFormat));
        }

        function updateAqiGauge(component, value, gaugeId) {
            const breakpoints = { co: [4400, 9400, 12400, 15400], no2: [40, 70, 150, 200], o3: [60, 100, 140, 180], so2: [20, 80, 250, 350] };
            const colors = ['#00ffc3', '#4caf50', '#ffeb3b', '#ff9800', '#f44336', '#9c27b0'];
            let level = 0;
            while (level < breakpoints[component].length && value > breakpoints[component][level]) { level++; }
            const gaugeEl = $(gaugeId);
            gaugeEl.css('width', `${Math.min(100, (value / (breakpoints[component][2] || 200)) * 100)}%`);
            gaugeEl.css('background-color', colors[level]);
        }

        async function updateAirQualityUI(lat, lon) {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
            const data = await response.json();
            const { co, no2, o3, so2 } = data.list[0].components;
            $('#coValue').text(co.toFixed(1));
            $('#no2Value').text(no2.toFixed(1));
            $('#o3Value').text(o3.toFixed(1));
            $('#so2Value').text(so2.toFixed(1));
            updateAqiGauge('co', co, '#coGauge');
            updateAqiGauge('no2', no2, '#no2Gauge');
            updateAqiGauge('o3', o3, '#o3Gauge');
            updateAqiGauge('so2', so2, '#so2Gauge');
        }

        async function updateForecastUI(lat, lon) {
            const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`);
            const data = await response.json();
            const hourlyContainer = $('#hourlyContainer').empty();
            data.list.slice(0, 6).forEach(item => { hourlyContainer.append(`<div class="hourly-item"><p>${new Date(item.dt * 1000).toLocaleTimeString('en-US', { hour: 'numeric', hour12: true })}</p><skycon-icon icon="${getSkycon(item.weather[0].icon)}" size="40"></skycon-icon><strong>${Math.round(item.main.temp)}°C</strong></div>`); });
            const dailyContainer = $('#dailyContainer').empty();
            const dailyData = {};
            data.list.forEach(item => {
                const day = new Date(item.dt * 1000).toLocaleDateString('en-US', { weekday: 'short' });
                if (!dailyData[day] && Object.keys(dailyData).length < 5) dailyData[day] = { temp: Math.round(item.main.temp), icon: getSkycon(item.weather[0].icon) };
            });
            for (const day in dailyData) { dailyContainer.append(`<div class="daily-item"><skycon-icon icon="${dailyData[day].icon}" size="48"></skycon-icon><p>${day}</p><strong>${dailyData[day].temp}°C</strong></div>`); }
        }

        async function fetchWeather(url) {
            $('#loader').removeClass('d-none');
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('City not found.');
                const data = await response.json();
                updateWeatherUI(data);
                await Promise.all([updateForecastUI(data.coord.lat, data.coord.lon), updateAirQualityUI(data.coord.lat, data.coord.lon)]);
            } catch (error) { alert(error.message); } finally { $('#loader').addClass('d-none'); }
        }

        function init() {
            navigator.geolocation.getCurrentPosition(
                pos => fetchWeather(`https://api.openweathermap.org/data/2.5/weather?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&appid=${API_KEY}&units=metric`),
                () => fetchWeather(`https://api.openweathermap.org/data/2.5/weather?q=Guwahati&appid=${API_KEY}&units=metric`)
            );
            $('#searchButton').on('click', () => {
                const city = $('#searchInput').val();
                if (city) fetchWeather(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`);
            });
            $('#searchInput').on('keypress', e => { if (e.key === 'Enter') $('#searchButton').click(); });
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('is-visible'); });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal-on-scroll').forEach(el => observer.observe(el));
            VanillaTilt.init(document.querySelectorAll(".card"), { max: 5, speed: 400, perspective: 1000 });
        }
        $(document).ready(init);
    </script>
</body>
</html>